---
layout: docwithnav-edge
title: ThingsBoard Edge CE v3.6.x upgrade instructions for Docker
description: ThingsBoard Edge CE v3.6.x upgrade guide for Docker
active-menu-item-click: "true"
breadcrumbs: true
breadcrumbs-steps: 2
breadcrumbs-show: 2
effective-url: '/docs/user-guide/install/edge/upgrade-instructions/'
---

* TOC
{:toc}

{% include templates/edge/install/docker-backup-before-upgrade.md %}

## Upgrading Edge CE to 3.6.4

{% assign versionName = "3.6.4EDGE" %}
{% assign previousVersion = "3.6.3EDGE" %}
{% assign updateServerLink = "docker/v3-6-x/#upgrading-thingsboard-ce-to-364" %}
{% include templates/edge/install/compatibility-warning-version.md %}
{% include templates/edge/user-guide/start-upgrade.md %}

## Upgrading Edge CE to 3.6.3

{% assign versionName = "3.6.3EDGE" %}
{% assign previousVersion = "3.6.2EDGE" %}
{% assign updateServerLink = "docker/v3-6-x/#upgrading-thingsboard-ce-to-363" %}
{% include templates/edge/install/compatibility-warning-version.md %}
{% include templates/edge/user-guide/start-upgrade.md %}

## Upgrading Edge CE to 3.6.2

{% assign versionName = "3.6.2EDGE" %}
{% assign previousVersion = "3.6.1EDGE" %}
{% assign updateServerLink = "docker/v3-6-x/#upgrading-thingsboard-ce-to-362" %}
{% include templates/edge/install/compatibility-warning-version.md %}

{% capture edge-previousVersion %}
These steps are applicable for Edge {{previousVersion}} version.
{% endcapture %}
{% include templates/info-banner.md content=edge-previousVersion %}

Set the terminal in the directory which contains the "docker-compose.yml" file, and run the following command to stop and remove the currently running TB Edge container (if it's still running):
```
docker compose stop && docker compose rm mytbedge -f
```
{: .copy-code}

### Migrating Data from Docker Bind Mount Folders to Docker Volumes

Starting with the {{versionName}} release, the ThingsBoard team has moved from using Docker bind mount folders to Docker volumes.
The goal of this change is to improve security and efficiency when storing data for Docker containers, and to mitigate permissions issues in different environments.

To migrate from Docker bind mounts to Docker volumes, please execute the following commands:

```bash
docker run --rm -v tb-edge-data:/volume -v ~/.mytb-edge-data:/backup busybox sh -c "cp -a /backup/. /volume"
docker run --rm -v tb-edge-logs:/volume -v ~/.mytb-edge-logs:/backup busybox sh -c "cp -a /backup/. /volume"
docker run --rm -v tb-edge-postgres-data:/volume -v ~/.mytb-edge-data/db:/backup busybox sh -c "cp -a /backup/. /volume"
```
{: .copy-code}

After the data migration to the newly created Docker volumes is complete, you'll need to update the volume mounts in your Docker Compose configuration.
Modify the `docker-compose.yml' file for ThingsBoard Edge to update the volume settings.

First, please update docker compose file version. Find the next snippet:

```text
version: '3.0'
...
```
And replace it with:
```text
version: '3.8'
```
{: .copy-code}

Then update the volume mounts. Locate the following snippet:

```text
    volumes:
      - ~/.mytb-edge-data:/data
      - ~/.mytb-edge-logs:/var/log/tb-edge
...
```
And replace it with:
```text
    volumes:
      - tb-edge-data:/data
      - tb-edge-logs:/var/log/tb-edge
```
{: .copy-code}

Apply a similar update to the PostgreSQL service. Locate the section:
```text
    volumes:
      - ~/.mytb-edge-data/db:/var/lib/postgresql/data
...
```

And replace it with:
```text
    volumes:
      - tb-edge-postgres-data:/var/lib/postgresql/data
```
{: .copy-code}

Finally, add the following volume section to the end of the file:
```text
volumes:
  tb-edge-data:
    name: tb-edge-data
  tb-edge-logs:
    name: tb-edge-logs
  tb-edge-postgres-data:
    name: tb-edge-postgres-data
```
{: .copy-code}

#### Backup Database

Before upgrading, make a copy of the database volume:

```bash
docker run --rm -v tb-edge-postgres-data:/source -v tb-edge-postgres-data-backup:/backup busybox sh -c "cp -a /source/. /backup"
```
{: .copy-code}

The next step creates a docker compose file for the **ThingsBoard Edge upgrade** process and runs the upgrade. Once the upgrade process is successfully completed, the TB Edge upgrade container is automatically stopped:

```
cat > docker-compose-upgrade.yml <<EOF && docker compose -f docker-compose-upgrade.yml up --abort-on-container-exit
version: '3.8'
services:
  mytbedge:
    restart: on-failure
    image: "thingsboard/tb-edge:{{versionName}}"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/tb-edge
    volumes:
      - tb-edge-data:/data
      - tb-edge-logs:/var/log/tb-edge
    entrypoint: upgrade-tb-edge.sh
  postgres:
    restart: always
    image: "postgres:15"
    ports:
      - "5432"
    environment:
      POSTGRES_DB: tb-edge
      POSTGRES_PASSWORD: postgres
    volumes:
      - tb-edge-postgres-data:/var/lib/postgresql/data

volumes:
  tb-edge-data:
    name: tb-edge-data
  tb-edge-logs:
    name: tb-edge-logs
  tb-edge-postgres-data:
    name: tb-edge-postgres-data
EOF
```
{: .copy-code.expandable-9}

Modify the main docker compose file (docker-compose.yml) for **ThingsBoard Edge** and update the image version:

```text
sed -i 's|thingsboard/tb-edge:{{previousVersion}}|thingsboard/tb-edge:{{versionName}}|' docker-compose.yml
```
{: .copy-code}

To start this docker compose, run the following command:
```
docker compose up -d && docker compose logs -f mytbedge
```
{: .copy-code}


## Upgrading Edge CE to 3.6.1

{% assign versionName = "3.6.1EDGE" %}
{% assign previousVersion = "3.6.0EDGE" %}
{% assign updateServerLink = "docker/v3-6-x/#upgrading-thingsboard-ce-to-361" %}
{% include templates/edge/install/compatibility-warning-version.md %}
{% capture edge-previousVersion %}
These steps are applicable for Edge {{previousVersion}} version.
{% endcapture %}
{% include templates/info-banner.md content=edge-previousVersion %}

Execute the following command to pull **{{versionName}}** image:
```
docker pull thingsboard/tb-edge:{{versionName}}
```
{: .copy-code}

Set the terminal in the directory which contains the "docker-compose.yml" file, and run the following command to stop and remove the currently running TB Edge container (if it's still running):
```
docker compose stop && docker compose rm mytbedge -f
```
{: .copy-code}

The next step creates a docker compose file for the **ThingsBoard Edge upgrade** process and runs the upgrade. 
Once the upgrade process is successfully completed, the TB Edge upgrade container is automatically stopped:

```
cat > docker-compose-upgrade.yml <<EOF && docker compose -f docker-compose-upgrade.yml up --abort-on-container-exit
version: '3.0'
services:
  mytbedge:
    restart: on-failure
    image: "thingsboard/tb-edge:{{versionName}}"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/tb-edge
    volumes:
      - ~/.mytb-edge-data:/data
      - ~/.mytb-edge-logs:/var/log/tb-edge
    entrypoint: upgrade-tb-edge.sh
  postgres:
    restart: always
    image: "postgres:15"
    ports:
      - "5432"
    environment:
      POSTGRES_DB: tb-edge
      POSTGRES_PASSWORD: postgres
    volumes:
      - ~/.mytb-edge-data/db:/var/lib/postgresql/data
EOF
```
{: .copy-code.expandable-9}

Modify the **main docker compose file** (docker-compose.yml) for **ThingsBoard Edge** and update the image version:

```text
sed -i 's|thingsboard/tb-edge:{{previousVersion}}|thingsboard/tb-edge:{{versionName}}|' docker-compose.yml
```
{: .copy-code}

To start this docker compose , run the following command:
```
docker compose up -d && docker compose logs -f mytbedge
```
{: .copy-code}

## Upgrading Edge CE to 3.6.0

{% assign versionName = "3.6.0EDGE" %}
{% assign previousVersion = "3.5.1.1EDGE" %}
{% assign updateServerLink = "docker/v3-6-x/#upgrading-thingsboard-ce-to-360" %}
{% include templates/edge/install/compatibility-warning-version.md %}

{% capture edge-previousVersion %}
These steps are applicable for Edge {{previousVersion}} version.
{% endcapture %}
{% include templates/info-banner.md content=edge-previousVersion %}
Execute the following command to pull **{{versionName}}** image:
```
docker pull thingsboard/tb-edge:{{versionName}}
```
{: .copy-code}

Set the terminal in the directory which contains the "docker-compose.yml" file, and run the following command to stop and remove the currently running TB Edge container (if it's still running):
```
docker compose stop && docker compose rm mytbedge -f
```
{: .copy-code}

The next step creates a docker compose file for the **ThingsBoard Edge upgrade** process and runs the upgrade. Once the upgrade process is successfully completed, the TB Edge upgrade container is automatically stopped:

```
cat > docker-compose-upgrade.yml <<EOF && docker compose -f docker-compose-upgrade.yml up --abort-on-container-exit
version: '3.0'
services:
  mytbedge:
    restart: on-failure
    image: "thingsboard/tb-edge:{{versionName}}"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/tb-edge
    volumes:
      - ~/.mytb-edge-data:/data
      - ~/.mytb-edge-logs:/var/log/tb-edge
    entrypoint: upgrade-tb-edge.sh
  postgres:
    restart: always
    image: "postgres:15"
    ports:
      - "5432"
    environment:
      POSTGRES_DB: tb-edge
      POSTGRES_PASSWORD: postgres
    volumes:
      - ~/.mytb-edge-data/db:/var/lib/postgresql/data
EOF
```
{: .copy-code.expandable-9}

Modify the **main docker compose file** (docker-compose.yml) for **ThingsBoard Edge** and update the image version:

```text
sed -i 's|thingsboard/tb-edge:{{previousVersion}}|thingsboard/tb-edge:{{versionName}}|' docker-compose.yml
```
{: .copy-code}

To start this docker compose , run the following command:
```
docker compose up -d && docker compose logs -f mytbedge
```
{: .copy-code}
