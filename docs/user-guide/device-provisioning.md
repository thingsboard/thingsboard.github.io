---
layout: docwithnav
title: Provisioning devices
description: IoT device management using ThingsBoard provisioning devices feature

---

* TOC
{:toc}

## Use Case description

As a device manufacturer or firmware developer, I would like my devices to automatically provision themselves in ThingsBoard.
During the automatic provisioning, device may either generate unique credentials or ask server to provide unique credentials for the device. 
   
## How it works?

<object width="80%" data="/images/user-guide/device-provisioning/flow.svg"></object>

The device may send device provisioning request (Request) to the ThingsBoard. The Request should always contain provision key and secret. 
The Request may optionally include the device name and credentials generated by the device. 
If those credentials are absent, the Server will generate an Access Token to be used by the device.

Provisioning request example:

```json
{
  "deviceName": "DEVICE_NAME",
  "provisionDeviceKey": "YOUR_PROVISION_KEY_HERE",
  "provisionDeviceSecret": "YOUR_PROVISION_SECRET_HERE"
}
```
{: .copy-code}

The ThingsBoard validates the Request and replies with the device provisioning response (Response). 
The successful response contains device id, credentials type and body. 
If the validation was not successful, the Response will contain only the status.

Provisioning response example:

```json
{
  "provisionDeviceStatus":"SUCCESS",  
  "credentialsType":"ACCESS_TOKEN",
  "accessToken":"sLzc0gDAZPkGMzFVTyUY"
}
```
{: .copy-code}

During the validation of the Request, ThingsBoard will first check the supplied *provisionDeviceKey* and *provisionDeviceSecret* to find the corresponding [Device Profile](/docs/user-guide/device-profiles/).
Once the profile was found, platform will use the configured provision strategy to validate the device name. 
There are two provision strategies available:

* *Allow to create new devices* - will check that device with such name was not registered in ThingsBoard yet. 
This strategy is useful when you don't know the list of unique device names (MAC addresses, etc) during manufacturing, but the device itself has access to this info in the firmware. 
It is easier to implement but less secure than the second strategy.  
* *Check pre-provisioned devices* - will check that the device with such name was already created in ThingsBoard but was not provisioned yet.
This strategy is useful when you want to allow provisioning only for specific list of devices. Let's assume that you have collected a list of unique ids (MAC addresses, etc) during manufacturing. 
You may use [bulk provisioning](/docs/user-guide/bulk-provisioning/) to upload this list to ThingsBoard. Now, devices from the list can issue provision requests, and no other devices will be able to provision themselves.  
          
Once the provisioning is complete, ThingsBoard will update *provisionState* server attribute of the device and sets it to *provisioned* value.

## Device profile configuration

You should configure device profile to enable provisioning feature and collect provision device key and provision device secret.

1. Create new device profile or open the existing one. We will create new one.     
Open the Device profiles page and click on "+" icon in the table header.
2. Input name of the new device profile and click on Step 4 of the "Add device profile" wizard. 
We will use "Device Provisioning Test" in this example. However, typically this should be your device model or similar. 
3. Choose one of the provisioning strategies, copy the provisioning key and secret and finally click "Add". 

{% capture gallery %}
    /images/user-guide/device-provisioning/device-provisioning-step-1.png
    /images/user-guide/device-provisioning/device-provisioning-step-2.png
    /images/user-guide/device-provisioning/device-provisioning-step-3.png
{% endcapture %} 
{% include images-gallery.html%}  

## Provision Device APIs 

#### MQTT Device APIs 

You may use the [MQTT API](/docs/reference/mqtt-api/#device-provisioning) reference to develop your device firmware that will perform the provision request.   
As mentioned earlier, device may request server to generate the credentials or provide its own credentials during the registration process.
See request/response and code examples for each option below:

{% capture mqttcredentialstogglespec %}
Credentials generated by ThingsBoard server%,%without%,%templates/provisioning/mqtt-without-credentials-type.md%br%
Devices supplies<br/>Access Token%,%access-token%,%templates/provisioning/mqtt-access-token-credentials-type.md%br%
Devices supplies<br/>Basic MQTT Credentials%,%mqtt-basic%,%templates/provisioning/mqtt-basic-credentials-type.md%br%
Devices supplies<br/>X.509 Certificate%,%x509-certificate%,%templates/provisioning/x509-certificate-credentials-type.md{% endcapture %}
{% include content-toggle.html content-toggle-id="mqttprovisioning" toggle-spec=mqttcredentialstogglespec %}

#### HTTP Device APIs 

You may use the [HTTP API](/docs/reference/http-api/#device-provisioning) reference to develop your device firmware that will perform the provision request.   
As mentioned earlier, device may request server to generate the credentials or provide its own credentials during the registration process.
See request/response and code examples for each option below:

{% capture httpcredentialstogglespec %}
Credentials generated by ThingsBoard server%,%without%,%templates/provisioning/http-without-credentials-type.md%br%
Devices supplies<br/>Access Token%,%access-token%,%templates/provisioning/http-access-token-credentials-type.md%br%{% endcapture %}
{% include content-toggle.html content-toggle-id="httpprovisioning" toggle-spec=httpcredentialstogglespec %}

#### CoAP Device APIs 

You may use the [CoAP API](/docs/reference/coap-api/#device-provisioning) reference to develop your device firmware that will perform the provision request.   
As mentioned earlier, device may request server to generate the credentials or provide its own credentials during the registration process.
See request/response and code examples for each option below:

{% capture coapcredentialstogglespec %}
Credentials generated by ThingsBoard server%,%without%,%templates/provisioning/coap-without-credentials-type.md%br%
Devices supplies<br/>Access Token%,%access-token%,%templates/provisioning/coap-access-token-credentials-type.md%br%{% endcapture %}
{% include content-toggle.html content-toggle-id="coapprovisioning" toggle-spec=coapcredentialstogglespec %}

## Next steps

{% assign currentGuide = "AdvancedFeatures" %}{% include templates/guides-banner.md %}