{
  "name": "TCP_GALILEOSKY_DOWNLINK",
  "type": "DOWNLINK",
  "debugMode": true,
  "configuration": {
    "encoder": "    var lenPacketStart = 26;\n    var result = setPayload();\n    var commandNumber;\n    var newPayload;\n    var separator;\n\n    function setPayload() {\n        if (msg.hasOwnProperty('payload') && metadata['payload'] !== null) {\n            return getPayload();\n        }\n        return null;\n    }\n\n    function getPayload() {\n        newPayload = [];\n         separator = \";\";\n        commandNumber = metadata['commandNumber'];\n        var rez = {\n            contentType: \"JSON\",\n            data:  getDataHexMany(),\n            metadata: {\n                serialNumber: metadata['cs_serialNumber'],\n                deviceName: metadata['originatorName'],\n                commandNumber: commandNumber,\n                // payload:  getPayloadTrim()\n                payload:  getNewPayloadStr ()\n            }\n        };\n        return rez;\n    }\n\n    function convertToHex(str) {\n        var hex = '';\n        for(var i=0;i<str.length;i++) {\n            hex += ''+str.charCodeAt(i).toString(16);\n        }\n        return hex;\n    }\n\n    function convertToHexFixLen(str, len){\n        var strHex = len +str.toString(16);\n        return strHex.substring(strHex.length - len.length);\n    }\n\n    function getDataHexMany() {\n        var dataArrays = msg.payload.split(separator);\n        var data = \"\";\n        for (var i = 0; i < dataArrays.length; i ++) {\n            data += (getDataHexOneForMany(dataArrays[i].trim()) + separator)\n        }\n        data = data.substring(0, data.lastIndexOf(separator));\n        return data;\n    }\n\n    function getDataHexOneForMany(str) {\n        var lenCommand = str.length;\n        var lenPacket = lenPacketStart + lenCommand;\n        var lenCommandHex = convertToHexFixLen(lenCommand, \"00\");\n        var lenPacketHex = hexStringToStringRev(convertToHexFixLen(lenPacket, \"0000\"));\n        var serialNumberHex = convertToHex(metadata['cs_serialNumber']);\n        var commandHex = convertToHex(str);\n        var commNumber = parseInt(commandNumber, 10);\n        commNumber ++;\n        // commNumber *= 10000;\n        var commNumberHex = convertToHexFixLen(commNumber, \"00000000\");\n        var dataHex = \"01\" + lenPacketHex  + \"03\" + serialNumberHex + \"04\" + \"0000\" + \"E0\" + commNumberHex + \"E1\" + lenCommandHex + commandHex;\n        var val = commNumberHex + \": \" + str;\n        newPayload.push (val);\n        commandNumber = commNumber.toString();\n        return dataHex;\n    }\n\n    function hexStringToStringRev(str) {\n        var strRev = \"\";\n        for (var i = (str.length - 2); i >= 0; i -= 2) {\n            strRev += str.substring(i, i + 2);\n        }\n        return strRev;\n    }\n\n    function getPayloadTrim () {\n        var dataArrays = msg.payload.split(separator);\n        var data = \"\";\n        for (var i = 0; i < dataArrays.length; i ++) {\n            data += (dataArrays[i].trim() + separator)\n        }\n        data = data.substring(0, data.lastIndexOf(separator));\n        return data;\n    }\n    function getNewPayloadStr () {\n        var data = \"\";\n        for (var i = 0; i < newPayload.length; i ++) {\n            data += (newPayload[i].trim() + separator)\n        }\n        data = data.substring(0, data.lastIndexOf(separator));\n        return data;\n    }\n\n    return result;"
  },
  "additionalInfo": null
}