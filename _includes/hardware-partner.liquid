{% assign partner = include.partner %}

<div class="hardware-partner">
    <div class="hardware-partner-card">
        <div class="hardware-partner-card-wrapper">
            <img src="{{ partner.logo }}" alt="{{ partner.name }} logo">
            <h1>{{ partner.name }}</h1>
            <p>{{ partner.description }}</p>
            <a href="{{ partner.site.href }}">
                <span>Website</span>
                <i class="fas fa-arrow-up"></i>
            </a>
        </div>
    </div>
    <div class="hardware-info">
        <table class="hardware-info-table">
            <tr>
                <th>Connectivity</th>
                <td>{{ partner.type | join: ', ' }}</td>
            </tr>
            <tr>
                <th>Industry</th>
                <td>{{ partner.industry | join: ', ' }}</td>
            </tr>
            <tr>
                <th>Use cases</th>
                <td>{{ partner.use-case | join: ', ' }}</td>
            </tr>
            <tr>
                <th>Hardware types</th>
                <td>{{ partner.hardware-types | join: ', ' }}</td>
            </tr>
        </table>
        {% if partner.showcase.href %}
            <div class="showcases">
                <span class="section-label">Showcases:</span>
                <ul>
                    <li><a href="{{ partner.showcase.href }}" class="hardware-crisp">Showcase</a></li>
                </ul>
            </div>
        {% endif %}
        {% if partner.links and partner.links.size > 0 %}
            <div class="guides">
                <span class="section-label">Guides:</span>
                <ul class="guide-list">
                    {% for link in partner.links %}
                        <li><a href="{{ link[1].href }}" class="hardware-crisp">{{ link[1].label }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>
</div>

<script>
    (function () {
        const containers = document.querySelectorAll('.guides');

        function applyRowClamp(container) {
            const list = container.querySelector('.guide-list');
            const items = Array.from(list?.children || []);
            const btn = container.querySelector('.toggle-guides-btn') || (() => {
                const b = document.createElement('button');
                b.type = 'button';
                b.className = 'toggle-guides-btn';
                b.hidden = true;
                b.innerHTML =
                    '<span class="label">Show more</span>' +
                    '<i class="fas fa-chevron-down fa-sm" aria-hidden="true" style="color: rgba(0,0,0,.76)"></i>';
                container.appendChild(b);
                return b;
            })();
            const label = btn.querySelector('.label');

            items.forEach(li => {
                li.classList.remove('collapsed')
            });
            btn.classList.remove('is-open');
            label.textContent = 'Show more';

            if (!items.length) { btn.hidden = true; return; }

            const rowTops = [];
            const extraItems = [];
            for (const li of items) {
                const top = li.offsetTop;
                if (!rowTops.includes(top)) rowTops.push(top);
                if (rowTops.length > 2) extraItems.push(li);
            }

            if (rowTops.length <= 3) { btn.hidden = true; return; }

            extraItems.forEach(li => li.classList.add('collapsed'));

            btn.hidden = extraItems.length === 0;
            if (!btn.hidden) {
                btn.onclick = () => {
                    const open = btn.classList.toggle('is-open');
                    extraItems.forEach(li => li.classList.toggle('collapsed', !open));
                    label.textContent = open ? 'Show less' : 'Show more';
                };
            }
        }

        const run = () => document.querySelectorAll('.guides').forEach(applyRowClamp);
        run();

        let t;
        window.addEventListener('resize', () => {
            clearTimeout(t);
            t = setTimeout(run, 250);
        });
    })();
</script>


