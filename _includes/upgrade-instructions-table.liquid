{%- assign dir = "/docs/" | append: docsPrefix | append: "releases/releases-table/" -%}

{%- assign pages_in_dir = site.pages
        | where_exp: "p", "p.url contains dir"
-%}

{%- assign pages_sorted = pages_in_dir | sort: "release-date" | reverse -%}

<div class="releases-table upgrade-instructions-table{% if docsPrefix == "pe/" %} pe-table{% endif %}">
    <div class="releases-table-content">
        <div class="releases-table-header">
            <div class="releases-table-header-item">Version</div>
            <div class="releases-table-header-item">Release Date</div>
            <div class="releases-table-header-item">Upgradable From</div>
            <div class="releases-table-header-item">LTS</div>
            <div class="releases-table-header-item">Release Notes</div>
            <div class="releases-table-header-item">Upgrade Instructions</div>
        </div>

        <div class="releases-table-row">
            {%- for p in pages_sorted -%}
                {%- unless p.name == 'index.md' or p.name contains '.x.md' -%}
                    {%- assign version = p.name | replace: ".md", "" -%}
                    {%- assign family = version | split: "." | slice: 0, 2 | join: "." -%}
                    <div class="releases-table-content-wrapper" data-version="{{ version }}" data-family="{{ family }}">
                        <div class="releases-table-content">
                            <div class="releases-table-content-item">{{ version }}</div>
                            <div class="releases-table-content-item">{{ p["release-date"] | date: "%B %e, %Y" }}</div>
                            <div class="releases-table-content-item">{{ p["upgradable-from"] | default: "â€”" }}</div>
                            <div class="releases-table-content-item">-</div>
                            <a href="/docs/{{ docsPrefix }}releases/releases-table/{{ version }}" class="releases-table-content-item version-link">
                                <span>{{ version }}</span>
                                <i class="fas fa-external-link-alt" style="opacity: 0.54; color: #000"></i>
                            </a>
                            <div class="releases-table-content-item upgrade-instructions">
                                <a href="/docs/user-guide/install/{{ docsPrefix }}upgrade-instructions/ubuntu/{{ version }}">
                                    <img src="/images/ubuntu.svg" alt="Upgrade Ubuntu Instructions">
                                </a>
                                <a href="/docs/user-guide/install/{{ docsPrefix }}upgrade-instructions/centos/{{ version }}">
                                    <img src="/images/centos.svg" alt="Upgrade CentOS Instructions">
                                </a>
                                <a href="/docs/user-guide/install/{{ docsPrefix }}upgrade-instructions/windows/{{ version }}">
                                    <img src="/images/windows.svg" alt="Upgrade Windows Instructions">
                                </a>
                                <a href="/docs/user-guide/install/{{ docsPrefix }}docker-windows/">
                                    <img src="/images/docker.svg" alt="Upgrade Docker Instructions">
                                </a>
                            </div>
                        </div>
                    </div>
                {%- endunless -%}
            {%- endfor -%}
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const params = new URLSearchParams(window.location.search);
        const versionParam = params.get("version");
        if (!versionParam) return;

        const targetFamily = versionParam.replace(/\.x$/i, "").trim();

        document
            .querySelectorAll(".upgrade-instructions-table .releases-table-content-wrapper")
            .forEach(function (row) {
                const rowFamily = row.getAttribute("data-family");
                if (rowFamily !== targetFamily) {
                    row.style.display = "none";
                }
            });
    });
</script>
