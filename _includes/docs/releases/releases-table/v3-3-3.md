### ThingsBoard CE v3.3.3 (January 27, 2022)

Minor release with the following improvements and bug fixes:

**Improvements**

* Core:
  * Alarm Query performance improvements;
  * Multi-root relation queries;
  * Ability to configure default null ordering in SQL requests;
  * REST API to fetch TB application version;
  * Do not persist empty stats to reducing event table size and disk IOPS;
  * Minor improvements to the thingsboard.yml comments;
  * Add password policy for white-spaces;
  * Notify IoT gateway about delete or rename of the device;
  * [#5200](https://github.com/thingsboard/thingsboard/pull/5200) 'IN' and 'NOT IN' conditions for the dashboard / alarm rule filters;
  * [#5749](https://github.com/thingsboard/thingsboard/pull/5749) Queue factories;
  * [#5760](https://github.com/thingsboard/thingsboard/pull/5760) SQL and TS batch thread count 3 for better hash distribution;
  * [#5814](https://github.com/thingsboard/thingsboard/pull/5814) API to clear events using filter;
* Rule Engine:
  * Support of nested rule-chains with multiple outputs;
  * [#5569](https://github.com/thingsboard/thingsboard/pull/5569) Ability to save time-series data without update of the latest values.
    Useful for performance improvements in case on hybrid DB setup;
  * Reduce CPU overhead for versions with in-memory cache;
  * Environment variable to configure in-memory cache;
  * [#5843](https://github.com/thingsboard/thingsboard/pull/5843) Device actor session inactivity performance + memory footprint optimizations;
  * [#5751](https://github.com/thingsboard/thingsboard/pull/5751) Transactional deletion of device and proper cache eviction
  * [#5550](https://github.com/thingsboard/thingsboard/pull/5550) Upgrade enrichment attributes rule node;
  * Misc performance improvements: immutable structures, pre-defined protobuf objects, etc;
  * [#5865](https://github.com/thingsboard/thingsboard/pull/5865) Added functionality to support 3.3.0 edge version rule chains;
  * [#5762](https://github.com/thingsboard/thingsboard/pull/5762) Suffix for the "clientId" param in the MQTT rule node;
  * [#5821](https://github.com/thingsboard/thingsboard/pull/5821) Add ignoreMetadataTs to 'save timeseries' rule node;
  * [#5889](https://github.com/thingsboard/thingsboard/pull/5889) Reduced number of scheduled messages for session timeout;
  * [#5921](https://github.com/thingsboard/thingsboard/pull/5921) Propagate alarms to Customer or Tenant without relations;
  * [#5926](https://github.com/thingsboard/thingsboard/pull/5926) Use message timestamp as alarm start timestamp in the 'create alarm' rule node;
  * [#5687](https://github.com/thingsboard/thingsboard/pull/5687) Self-intersecting polygons, polygons with holes, multiple polygons support;
* UI:
  * Migration to Angular 12;
  * Widget to embed different dashboard state;
  * Ability to embed dashboard states inside markdown widget;
  * [#5942](https://github.com/thingsboard/thingsboard/pull/5942) Add script to generate data structures for custom widgets;
  * [#5797](https://github.com/thingsboard/thingsboard/pull/5797) Separate pages for entity details;
  * [#5770](https://github.com/thingsboard/thingsboard/pull/5770) Editor of markers and polygons in maps widgets;
  * [#5757](https://github.com/thingsboard/thingsboard/pull/5757) Improvement of multiple attribute widget;
  * [#5629](https://github.com/thingsboard/thingsboard/pull/5629) Widget to display Persistent RPC calls;
  * [#5856](https://github.com/thingsboard/thingsboard/pull/5856) Persistent page link for entities pages;
  * Create nested rule chain from the selected region in the rule chain editor;
  * Add tooltip offset settings for map widgets;
  * [#5655](https://github.com/thingsboard/thingsboard/pull/5655) Hide page size option on mobile view;
  * [#5772](https://github.com/thingsboard/thingsboard/pull/5772) Show legend settings in time-series and latest widgets only;
  * [#5795](https://github.com/thingsboard/thingsboard/pull/5795) Disable column sort if enable post-processing function;
  * [#5876](https://github.com/thingsboard/thingsboard/pull/5876) Image map resize calculates center position correctly;
  * [#5882](https://github.com/thingsboard/thingsboard/pull/5882) New map widget settings: "Disable zoom control";
  * [#5910](https://github.com/thingsboard/thingsboard/pull/5910) Added additional condition to define showTitleIcon;
* Transport:
  * LwM2M:
    * Ability to define network configuration;
    * [#5930](https://github.com/thingsboard/thingsboard/pull/5930) Updated Eclipse Leshan version to 2.0.0-M5;
    * Support of Base64 format to define client keys in RPK and X509 mode;
    * Introduce support of new commands: Read-Composite, Write-Composite. Multiple-Instance Resources Read and Write;
    * Introduce support of new content formats: SenML JSON, SenML CBOR;
    * Improvements to configuration of Bootstrap behavior via Device Profile;  
    * Bootstrap server now supports: Read, Discover, Write, Delete commands;
  * CoAP:
    * [#5930](https://github.com/thingsboard/thingsboard/pull/5930) Updated Californium version to 3.0.0;
  * SNMP:
    * Add Redis config for SNMP transport;
  * MQTT:
    * [5875] IP Rate limits for MQTT;
* Security:
  * Update version of log4j-core, log4j-api and log4j-to-slf4j;
  * Ability to limit alarm queries invocation count;
  * [#5823](https://github.com/thingsboard/thingsboard/pull/5823) Add NO XSS validation for names of rule nodes;
* Build scripts:
  * Support of linux/arm64 docker containers;
  * SQL tests are now running on real PostgreSQL instead of HSQL;
  * Update grpc and netty versions to proper handle native windows ssl libraries;

**Bug fixes**

* Core & Rule Engine:
  * Upgrade of device profiles from 3.2.2;
  * [#5492](https://github.com/thingsboard/thingsboard/pull/5492) Conversion of double values in WS subscriptions;
  * [#5753](https://github.com/thingsboard/thingsboard/pull/5753) Unsorted page link replaced with sort by id ASC;
  * [#5744](https://github.com/thingsboard/thingsboard/pull/5744) remediation for log4shell CVE-2021-45105;
  * Link to Wiki page about UUID in REST API documentation;
  * Notification about deleted attributes in the cluster mode;
  * [#5750](https://github.com/thingsboard/thingsboard/pull/5750) Notification about deleted time-series records;
  * [#5657](https://github.com/thingsboard/thingsboard/pull/5657) Fix search API Swagger description;
  * [#5793](https://github.com/thingsboard/thingsboard/pull/5793) Added functionality to handle pong responses on web sockets;
  * [#5822](https://github.com/thingsboard/thingsboard/pull/5822) Do not update WS last activity in case of general response;
  * Removing old OTA tag if new tag is empty during OTA scheduling;
  * [#5869](https://github.com/thingsboard/thingsboard/pull/5869) Don't allow system administrator to delete himself;
  * [#5864](https://github.com/thingsboard/thingsboard/pull/5864) Fixed aggregation by timezone in Timescale;
  * Ignore no longer valid messages when processing strategy is completed or timed-out;
  * [#5557](https://github.com/thingsboard/thingsboard/pull/5557) Fix NPE in case of incorrect partitioning name parameter;
  * [#5787](https://github.com/thingsboard/thingsboard/pull/5787) Removed incorrect statistics calculation for regularQueryInvocationCnt/regularQueryInvocationTime;
  * [#5659](https://github.com/thingsboard/thingsboard/pull/5659) Add rpc response error when retry attempts ended;
  * [#5852](https://github.com/thingsboard/thingsboard/pull/5852) Support of double type in 'save to custom table' rule node;
  * Prevent click actions and popup open while dragging the marker in map widgets.
* UI:
  * [#5755](https://github.com/thingsboard/thingsboard/pull/5755) Support of rectangles with cut area;
  * Layout for Firefox;
  * Open dashboard state in separate dialog showed a blank dialog;
  * Right layout and state name propagation in mobile app;
  * Resolve alias filter for query alias types;
  * JSON form default values handling;
  * [#5529](https://github.com/thingsboard/thingsboard/pull/5529) Chinese translation for the API usage;
  * [#5778](https://github.com/thingsboard/thingsboard/pull/5778) Filter forms: constant type and boolean value;
  * [#5805](https://github.com/thingsboard/thingsboard/pull/5805) Help link for OTA updates;
  * [#5813](https://github.com/thingsboard/thingsboard/pull/5813) Cancel event on color picker;
  * [#5832](https://github.com/thingsboard/thingsboard/pull/5832) Problematic letters for different languages;
  * [#5872](https://github.com/thingsboard/thingsboard/pull/5872) Error in device-profile-autocomplete and tenant-profile-autocomplete in clear;
  * [#5879](https://github.com/thingsboard/thingsboard/pull/5879) Prevent saving of invalid form in the multiple input widget;
  * [#5883](https://github.com/thingsboard/thingsboard/pull/5883) Fixed OTA package autocomplete;
  * [#5913](https://github.com/thingsboard/thingsboard/pull/5913) Date Range Navigator: the calendar when selecting dates should be horizontal;
  * [#5923](https://github.com/thingsboard/thingsboard/pull/5923) Asset models added to public api;
  * [#5928](https://github.com/thingsboard/thingsboard/pull/5928) Fixed help link URL for the 'Add user' dialog;
  * [#5931](https://github.com/thingsboard/thingsboard/issues/5931) The timestamp of the exception in the Rule Engine Statistics dashboard is wrong;
  * [#5948](https://github.com/thingsboard/thingsboard/issues/5948) Change "snpm" directory to "snmp";
* Transport:
  * LwM2M:
    * duplicated OTA update after device awake from PSM/eDRX;
    * [#5716](https://github.com/thingsboard/thingsboard/pull/5716) added ability to send LwM2M model updates after sleeping;
    * [#5878](https://github.com/thingsboard/thingsboard/pull/5878) correct handling of device profile update;
    * [#5953](https://github.com/thingsboard/thingsboard/pull/5953) subscription to RPC and Attributes;
    * [#5955](https://github.com/thingsboard/thingsboard/pull/5955) initialization order;
    * Bugs with OTA update sequence on client reboot or reconnect;
  * MQTT:
    * Corner case when access token matches user name in credentials;
    * [#5792](https://github.com/thingsboard/thingsboard/pull/5792) Invalid serialization of '=' to \u003d in JsonMqttAdaptor;
    * [#5788](https://github.com/thingsboard/thingsboard/pull/5788) Reduce MQTT info logs for connect/disconnect events;
    * [#5796](https://github.com/thingsboard/thingsboard/pull/5796) Response format of multiple attributes request;
* Rest Client:
  * [#5566](https://github.com/thingsboard/thingsboard/pull/5566) Fixed widget type based methods in rest client;
* Edge:
  * [#5922](https://github.com/thingsboard/thingsboard/pull/5922) Minor fixes and code review comments;
* Build scripts:
  * Integration test lifecycle;
  * [#5672](https://github.com/thingsboard/thingsboard/pull/5672) CASSANDRA_KEYSPACE_NAME ignored during install;
