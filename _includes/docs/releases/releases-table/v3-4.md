### ThingsBoard CE v3.4 (July 19, 2022)

Major release with the following features and bug fixes:

**Major Improvements**

* Core & Rule Engine:
  * [#6534](https://github.com/thingsboard/thingsboard/pull/6534) Configuration of Rule Engine queues via Tenant Profiles. See documentation [here](/docs/user-guide/rule-engine-2-5/queues/);
  * [#6070](https://github.com/thingsboard/thingsboard/issues/6070) 2FA support. See documentation [here](/docs/user-guide/two-factor-authentication/).
  * [#6759](https://github.com/thingsboard/thingsboard/pull/6759) Version Control (Git integration). See documentation [here](/docs/user-guide/version-control/).
  * [#6893](https://github.com/thingsboard/thingsboard/pull/6893) Refactor JS-Executor microservice to typescript;  
* UI:
  * [#6334](https://github.com/thingsboard/thingsboard/issues/6334) Support of the latest values in the time-series widgets;
  * [#6545](https://github.com/thingsboard/thingsboard/pull/6545) Replace auto-generated advanced widget settings JSON forms with Angular components;
* Edge:
  * [#6781](https://github.com/thingsboard/thingsboard/pull/6781) Edge OTA support;
  * [#6852](https://github.com/thingsboard/thingsboard/pull/6852) Queue API support.
  
**Minor Improvements**

* Core & Rule Engine:
  * [#6483](https://github.com/thingsboard/thingsboard/pull/6483) Refactoring of some REST controllers code to Entity Services; 
    See PRs: [#6533](https://github.com/thingsboard/thingsboard/pull/6533), [#6540](https://github.com/thingsboard/thingsboard/pull/6540), [#6551](https://github.com/thingsboard/thingsboard/pull/6551),
    [#6582](https://github.com/thingsboard/thingsboard/pull/6582), [#6593](https://github.com/thingsboard/thingsboard/pull/6593), [#6695](https://github.com/thingsboard/thingsboard/pull/6695);
  * [#6358](https://github.com/thingsboard/thingsboard/issues/6358) Improved query logging;
  * [#6412](https://github.com/thingsboard/thingsboard/pull/6412) InMemoryStorage refactored from the static singleton to the Spring Bean;
  * [#6422](https://github.com/thingsboard/thingsboard/pull/6422) In memory storage improvements;
  * [#6485](https://github.com/thingsboard/thingsboard/pull/6485) Refactoring of Spring Security annotations according to new Spring release;
  * [#6767](https://github.com/thingsboard/thingsboard/issues/6767) Improved JS executor performance and memory foot-print;
  * [#6785](https://github.com/thingsboard/thingsboard/pull/6785) EntityViewService optimization using local cache and lifecycle event broadcasting;
  * [#6780](https://github.com/thingsboard/thingsboard/pull/6780) QueueKey toString for a better logging experience;
  * [#6888](https://github.com/thingsboard/thingsboard/pull/6888) Expiration time for JS executor tasks to improve performance;
  * [#6201](https://github.com/thingsboard/thingsboard/issues/6201) SMPP SMS provider;
  * [#5818](https://github.com/thingsboard/thingsboard/pull/5818) Add support for dynamic values for schedules in alarm rules;
  * [#5959](https://github.com/thingsboard/thingsboard/pull/5959) Cacheable tenantExists method and refactor usages in validators;
* UI:
  * [#6675](https://github.com/thingsboard/thingsboard/pull/6675) Added 'Security' page;
  * [#6555](https://github.com/thingsboard/thingsboard/pull/6555) Add 'Maximum entities per datasource' parameter to widget configuration;
  * [#6432](https://github.com/thingsboard/thingsboard/pull/6432) Update Italian locale;
  * [#6626](https://github.com/thingsboard/thingsboard/pull/6626) Update Spanish locale;
  * [#6914](https://github.com/thingsboard/thingsboard/pull/6914) Update French locale; 
  * [#6584](https://github.com/thingsboard/thingsboard/pull/6584) Add Chinese translations for edge;
  * [#6434](https://github.com/thingsboard/thingsboard/pull/6434) Fix validation logic for JSON in attributes edit form;
  * [#6635](https://github.com/thingsboard/thingsboard/pull/6635) Add resource service to widget context;
  * [#6650](https://github.com/thingsboard/thingsboard/pull/6650) Phone input with country flags;
  * [#6725](https://github.com/thingsboard/thingsboard/pull/6725) Added validation for a required label in dataKey setting;
  * [#6728](https://github.com/thingsboard/thingsboard/pull/6728) Export all RxJS API into custom widget context;
  * [#6733](https://github.com/thingsboard/thingsboard/pull/6733) Use default image in the image-map widget;
  * [#6805](https://github.com/thingsboard/thingsboard/pull/6805) Layout for tenant profiles and queues;
  * [#6788](https://github.com/thingsboard/thingsboard/pull/6788) Add option to show the latest values in the widget's legend;
  * [#6836](https://github.com/thingsboard/thingsboard/pull/6836) Support of 'flush all' operations in case we use Redis cluster;
* Transport:
  * [#6522](https://github.com/thingsboard/thingsboard/pull/6522) Piggybacked CoAP responses;
  * [#6233](https://github.com/thingsboard/thingsboard/issues/6233) Configuration of MQTT transport behavior on message validation failure;
  * [#6486](https://github.com/thingsboard/thingsboard/pull/6486) Refactored MQTT and COAP integration tests;
  * [#6919](https://github.com/thingsboard/thingsboard/pull/6919) Refactored LwM2M integration tests;
  * [#6667](https://github.com/thingsboard/thingsboard/issues/6667) Kafka producer compression configuration;
* Edge:
  * [#6684](https://github.com/thingsboard/thingsboard/pull/6684) Report device activity from Edge;
  * [#6443](https://github.com/thingsboard/thingsboard/issues/6443) Updated default edge root rule chain to handle `Attributes Deleted`, `Timeseries Deleted`, `Timeseries Updated` messages by default;
* Build scripts:
  * [#6190](https://github.com/thingsboard/thingsboard/pull/6190) Docker image size optimization. See PRs: [#6784](https://github.com/thingsboard/thingsboard/pull/6784);
  * [#6265](https://github.com/thingsboard/thingsboard/pull/6265) Updated third-party versions. See PRs: [#6687](https://github.com/thingsboard/thingsboard/issues/6687), [#6709](https://github.com/thingsboard/thingsboard/pull/6709);
  * [#6415](https://github.com/thingsboard/thingsboard/pull/6415) Test speed up. See also PRs: [#6431](https://github.com/thingsboard/thingsboard/pull/6431), [#6537](https://github.com/thingsboard/thingsboard/pull/6537), 
    [#6603](https://github.com/thingsboard/thingsboard/pull/6603);
  * [#6504](https://github.com/thingsboard/thingsboard/pull/6504) Refactoring of SQL Test Suite;
  * [#6793](https://github.com/thingsboard/thingsboard/pull/6793) Tests for Redis cluster;
  * [#6847](https://github.com/thingsboard/thingsboard/pull/6847) Check folder permissions in docker-compose scripts.
  
**Bug Fixes**

* Core & Rule Engine:
  * [#6536](https://github.com/thingsboard/thingsboard/pull/6536) Misc cache issues with race conditions;
  * [#6910](https://github.com/thingsboard/thingsboard/pull/6910) Mail server timeout implementation;
  * [#6535](https://github.com/thingsboard/thingsboard/pull/6535) Handling alarm deletion and attributes deletion in DeviceState;
  * [#4666](https://github.com/thingsboard/thingsboard/issues/4666) Encoding of request params in the Rest API call rule node;
  * [#6315](https://github.com/thingsboard/thingsboard/issues/6315) Kafka rule node;
  * [#6323](https://github.com/thingsboard/thingsboard/issues/6323) Entity views caching;
  * [#6330](https://github.com/thingsboard/thingsboard/pull/6330) SQL error on reinstall;
  * [#6446](https://github.com/thingsboard/thingsboard/pull/6446) Method to upload OTA binary file via Swagger ui;
  * [#6642](https://github.com/thingsboard/thingsboard/pull/6642) Permission checks for getDeviceProfileInfoById REST API call;
  * [#6421](https://github.com/thingsboard/thingsboard/issues/6421) NPE in 'copy to view' rule node;
  * [#6682](https://github.com/thingsboard/thingsboard/pull/6682) Slow queries logging;
  * [#6711](https://github.com/thingsboard/thingsboard/issues/6711) Swagger UI typo fix for dashboard API;
  * [#6809](https://github.com/thingsboard/thingsboard/issues/6808) JS executor crash on error code check;
  * [#6875](https://github.com/thingsboard/thingsboard/pull/6875) Added device-profile read permissions for the customer;
  * [#6895](https://github.com/thingsboard/thingsboard/pull/6895) Removed unused audit log config settings;  
  * [#6929](https://github.com/thingsboard/thingsboard/pull/6929) Removed 'isolated tb-core' flag in tenant profile;    
  * [#6901](https://github.com/thingsboard/thingsboard/pull/6901/files) Device & device-profile validation;
  * [#6931](https://github.com/thingsboard/thingsboard/pull/6931) Export/Import RuleChain for nested RuleChains;
  * [#6937](https://github.com/thingsboard/thingsboard/pull/6937) Transport statistics logging;
  * [#6939](https://github.com/thingsboard/thingsboard/pull/6939) Single Partition for Kafka response topics;
  * [#5924](https://github.com/thingsboard/thingsboard/pull/5924) "403 forbidden" error when a tenant creates a relations with themselves;
* UI:
  * [#6886](https://github.com/thingsboard/thingsboard/pull/6886) Double click zooming on map widgets;
  * [#6495](https://github.com/thingsboard/thingsboard/issues/6495) Trip Animation widget bug. See also [#6496](https://github.com/thingsboard/thingsboard/pull/6496);
  * [#6651](https://github.com/thingsboard/thingsboard/issues/6651) Date Range navigator widget date selection; 
  * [#6671](https://github.com/thingsboard/thingsboard/issues/6671) Visual bugs in pie flot widget;
  * [#6141](https://github.com/thingsboard/thingsboard/issues/6141) Resize in Knob Control widget;  
  * [#6475](https://github.com/thingsboard/thingsboard/pull/6475) Entities table manual sort if pagination disabled;
  * [#6462](https://github.com/thingsboard/thingsboard/pull/6462) Displaying 'Unit title' and 'value timestamp' for Digital gauges widgets;
  * [#6298](https://github.com/thingsboard/thingsboard/pull/6298) UI build according to new [github policy](https://github.blog/2021-09-01-improving-git-protocol-security-github/);
  * [#6321](https://github.com/thingsboard/thingsboard/pull/6321) Zooming of the Image Map;
  * [#6339](https://github.com/thingsboard/thingsboard/pull/6339) UI build in Windows OS;
  * [#6349](https://github.com/thingsboard/thingsboard/issues/6349) Duplicated dialogs on redirect;
  * [#6550](https://github.com/thingsboard/thingsboard/issues/6550) Can't switch to another rule chain without confirming/cancelling changes;
  * [#6690](https://github.com/thingsboard/thingsboard/pull/6690) Incorrect display of delayed status;
  * [#6706](https://github.com/thingsboard/thingsboard/issues/6706) Remove extra scroll in the widget dialog;
  * [#6336](https://github.com/thingsboard/thingsboard/issues/6336) "Test script function" window is now adapted to screen reduction;
  * [#6743](https://github.com/thingsboard/thingsboard/issues/6743) The dashboard edit icon disappears when ESC button is pressed;
  * [#6514](https://github.com/thingsboard/thingsboard/issues/6514) Pagination for edge downlink table;
  * [#6769](https://github.com/thingsboard/thingsboard/pull/6769) Incorrect label in tenant profile;
  * [#6774](https://github.com/thingsboard/thingsboard/issues/6774) Permission check in show alarm details;
  * [#6908](https://github.com/thingsboard/thingsboard/issues/6908) Timeseries widget doesn't react on dashboard timewindow update if used within state widget;
  * [#6916](https://github.com/thingsboard/thingsboard/pull/6916) Tooltip actions that contains space in name for map widgets;
  * [#6936](https://github.com/thingsboard/thingsboard/pull/6936) Import/export/copy operations for alarm type widgets;
* Edge:
  * [#6436](https://github.com/thingsboard/thingsboard/issues/6436) Push to edge rule node generates 'timeout' message in case no related edges found;
  * [#6519](https://github.com/thingsboard/thingsboard/pull/6519) Device profile with non default transport is not propagated to edge;
  * [#6699](https://github.com/thingsboard/thingsboard/pull/6699) Validation of missing rule chain;
  * [#6840](https://github.com/thingsboard/thingsboard/pull/6840) Saving of edge event in batches should be single threaded;
* Build scripts:
  * [#6719](https://github.com/thingsboard/thingsboard/pull/6719) Await postgres startup in a bundled docker image;
  * [#6721](https://github.com/thingsboard/thingsboard/pull/6721) Updated Node version from 12 to 16 for web-ui and js-executor; 
  * [#6729](https://github.com/thingsboard/thingsboard/pull/6729) Correct postgresql repo in docker files;
  * [#6813](https://github.com/thingsboard/thingsboard/pull/6813) Various docker-compose fixes. 
    See also [#6812](https://github.com/thingsboard/thingsboard/pull/6812), [#6811](https://github.com/thingsboard/thingsboard/pull/6811).
