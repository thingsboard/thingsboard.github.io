### ThingsBoard CE v4.0.0 (Apr 15, 2025)

Major release with the following features and bug fixes:

**Major Improvements**

* Core & Rule Engine

  * [#12374](https://github.com/thingsboard/thingsboard/pull/12374) Calculated Fields by @irynamatveieva and @ViacheslavKlimov
  * [#12527](https://github.com/thingsboard/thingsboard/pull/12527) High-performance, in-memory Entity Data Query Service (EDQS) by @dashevchenko and @ViacheslavKlimov
  * [#12764](https://github.com/thingsboard/thingsboard/pull/12764) Save attributes strategies by @dskarzh
  * [#12413](https://github.com/thingsboard/thingsboard/pull/12413) Save time series strategies by @dskarzh
  * [#12652](https://github.com/thingsboard/thingsboard/pull/12652) Added entity alias and filters for Alarm Count Widget by @dashevchenko

* UI

  * [#12875](https://github.com/thingsboard/thingsboard/pull/12875) New Map widgets by @ikulikov
  * [#12325](https://github.com/thingsboard/thingsboard/pull/12325) Implemented dynamic forms to remove JSON schema forms by @ikulikov
  * [#12274](https://github.com/thingsboard/thingsboard/pull/12274) SCADA: High-performance Oil and Gas symbols by @ArtemDzhereleiko
  * [#12512](https://github.com/thingsboard/thingsboard/pull/12512) SCADA: High-performance Energy System symbols by @ArtemDzhereleiko
  * [#12372](https://github.com/thingsboard/thingsboard/pull/12372) SCADA: Added traditional Meter SCADA symbols by @ArtemDzhereleiko
  * [#12848](https://github.com/thingsboard/thingsboard/pull/12848) Improved widget header button action by @ArtemDzhereleiko

**Minor improvements**

* Core & Rule Engine

  * [#12297](https://github.com/thingsboard/thingsboard/pull/12297) Refactored telemetry service by @ViacheslavKlimov
  * [#12688](https://github.com/thingsboard/thingsboard/pull/12688) Added bundles to widget type info by @AndriiLandiak
  * [#12508](https://github.com/thingsboard/thingsboard/pull/12508) Added validation for resource usage across entities by @artem-barysh-dev
  * [#12588](https://github.com/thingsboard/thingsboard/pull/12588) Made more Kafka topics configurable by @AndriiLandiak

* UI

  * [#12856](https://github.com/thingsboard/thingsboard/pull/12856) Implemented TBEL utils autocompletes and highlights by @maxunbearable
  * [#12467](https://github.com/thingsboard/thingsboard/pull/12467) Added action to provision device via mobile app by @maxunbearable
  * [#12933](https://github.com/thingsboard/thingsboard/pull/12933) Added link to help page for timewindow settings by @ChantsovaEkaterina
  * [#12711](https://github.com/thingsboard/thingsboard/pull/12711) Added property decimals for flow meter symbol by @ArtemDzhereleiko
  * [#12551](https://github.com/thingsboard/thingsboard/pull/12551) Added 'Get dashboard state object' action by @vvlladd28
  * [#12723](https://github.com/thingsboard/thingsboard/pull/12723) Added map action buttons by @vvlladd28
  * [#12540](https://github.com/thingsboard/thingsboard/pull/12540) Added radio button for multiple input widget by @ArtemDzhereleiko
  * [#12817](https://github.com/thingsboard/thingsboard/pull/12817) Added scale format for SCADA tank with units by @ArtemDzhereleiko
  * [#12790](https://github.com/thingsboard/thingsboard/pull/12790) Added settings to disable sorting in Table-widgets by @Terny22
  * [#12446](https://github.com/thingsboard/thingsboard/pull/12446) Added domain update request chaining by @maxunbearable
  * [#12913](https://github.com/thingsboard/thingsboard/pull/12913) Added help for retrieving the dashboard state ID in actions by @ArtemDzhereleiko
  * [#12908](https://github.com/thingsboard/thingsboard/pull/12908) Adjusted the help button color and position in the admin settings card by @ArtemDzhereleiko 
  * [#12630](https://github.com/thingsboard/thingsboard/pull/12630) Improved behavior of changing start/end time in timewindow component by @ChantsovaEkaterina
  * [#12682](https://github.com/thingsboard/thingsboard/pull/12682) Improved description for SCADA symbols by @ArtemDzhereleiko
  * [#12928](https://github.com/thingsboard/thingsboard/pull/12928) Improved event handling hotkeys for Mac on the rule chain page by @ArtemDzhereleiko
  * [#12704](https://github.com/thingsboard/thingsboard/pull/12704) Improved Mobile center validators, removed redundant request by @deaflynx
  * [#12749](https://github.com/thingsboard/thingsboard/pull/12749) Improved pagination settings by @Terny22
  * [#12407](https://github.com/thingsboard/thingsboard/pull/12407) Migrated rule node config components from another repository by @vvlladd28
  * [#12627](https://github.com/thingsboard/thingsboard/pull/12627) Value stepper widget by @ArtemDzhereleiko
  * [#12781](https://github.com/thingsboard/thingsboard/pull/12781) Flow animation for HP SCADA connectors by @ArtemDzhereleiko
  * [#12509](https://github.com/thingsboard/thingsboard/pull/12509) Calculated Fields UI by @maxunbearable
  * [#12556](https://github.com/thingsboard/thingsboard/pull/12556) Ability to extract widget settings component from system module by @vvlladd28

* Edge

  * [#9195](https://github.com/thingsboard/thingsboard/pull/9195) Added ability to create Rule Chain on Edge by @AndriiLandiak
  * [#12458](https://github.com/thingsboard/thingsboard/pull/12458) Alarm ack & alarm clear are sent by 'Push to Edge' node only by @AndriiLandiak
  * [#12448](https://github.com/thingsboard/thingsboard/pull/12448) Improved attribute update strategy by @AndriiLandiak
  * [#12365](https://github.com/thingsboard/thingsboard/pull/12365) Improved related edges cache cleanup by @AndriiLandiak

**Bug fixes**

* Core & Rule Engine

  * [#12667](https://github.com/thingsboard/thingsboard/pull/12667) Fixed audit log save error when saving resource by @YevhenBondarenko
  * [#12763](https://github.com/thingsboard/thingsboard/pull/12763) Fixed entity version setting after creation by @ViacheslavKlimov
  * [#12751](https://github.com/thingsboard/thingsboard/pull/12751) Fixed extraction of queue name from msg in Input rule node by @YevhenBondarenko
  * [#12854](https://github.com/thingsboard/thingsboard/pull/12854) Fixed repository settings deletion ([Version control]) by @dashevchenko
  * [#12774](https://github.com/thingsboard/thingsboard/pull/12774) Fixed serializers removal from config ([Kafka node]) by @YevhenBondarenko
  * [#12736](https://github.com/thingsboard/thingsboard/pull/12736) Fixed StatsPersistTick scheduled future cancellation on actor destroy by @smatvienko-tb
  * [#13013](https://github.com/thingsboard/thingsboard/pull/13013) Fixed issue with adding threshold in line chart widget by @dashevchenko

* UI

  * [#12666](https://github.com/thingsboard/thingsboard/pull/12666) Fixed apply changes button enabled by default in device profile transport configuration tab by @vvlladd28
  * [#12393](https://github.com/thingsboard/thingsboard/pull/12393) Fixed blank screen on SCADA editor page refresh in development mode by @vvlladd28
  * [#12623](https://github.com/thingsboard/thingsboard/pull/12623) Fixed blur effect issue in the Getting Started widget by @vvlladd28
  * [#12888](https://github.com/thingsboard/thingsboard/pull/12888) Fixed changed event behavior in the nav tree component by @ArtemDzhereleiko
  * [#12898](https://github.com/thingsboard/thingsboard/pull/12898) Fixed close button position in the Vertical Cylinder Tank widget by @ArtemDzhereleiko
  * [#12443](https://github.com/thingsboard/thingsboard/pull/12443) Fixed columns to display filter panel scroll when on dashboard edge by @maxunbearable
  * [#12633](https://github.com/thingsboard/thingsboard/pull/12633) Fixed CSV export for strings containing semicolon by @ChantsovaEkaterina
  * [#12917](https://github.com/thingsboard/thingsboard/pull/12917) Fixed default event handling and added hotkeys for Mac on the dashboard page by @ArtemDzhereleiko
  * [#12899](https://github.com/thingsboard/thingsboard/pull/12899) Fixed default shape for Horizontal Ellipse Tank widget by @ArtemDzhereleiko
  * [#12810](https://github.com/thingsboard/thingsboard/pull/12810) Fixed device profile extra scroll in LwM2M model by @deaflynx
  * [#12878](https://github.com/thingsboard/thingsboard/pull/12878) Fixed drag and drop for data keys chip by @ArtemDzhereleiko
  * [#12416](https://github.com/thingsboard/thingsboard/pull/12416) Fixed empty notifications on slow WS connection by @maxunbearable
  * [#12544](https://github.com/thingsboard/thingsboard/pull/12544) Fixed Entity data subscription command keys duplicates by @deaflynx
  * [#12634](https://github.com/thingsboard/thingsboard/pull/12634) Fixed entity details page link in entity autocomplete component by @vvlladd28
  * [#12892](https://github.com/thingsboard/thingsboard/pull/12892) Fixed get rule chains for entity list component by @ArtemDzhereleiko
  * [#12610](https://github.com/thingsboard/thingsboard/pull/12610) Fixed incorrect search by LwM2M models by @vvlladd28
  * [#12628](https://github.com/thingsboard/thingsboard/pull/12628) Fixed mdc notch unnecessary border by @maxunbearable
  * [#12470](https://github.com/thingsboard/thingsboard/pull/12470) Fixed OAuth client ID and secret removal with slow internet by @maxunbearable
  * [#12841](https://github.com/thingsboard/thingsboard/pull/12841) Fixed pop-up closing issue on dashboards by @kalutkaz
  * [#12471](https://github.com/thingsboard/thingsboard/pull/12471) Fixed tooltip scroll issue in JS Library alias error state by @maxunbearable
  * [#12802](https://github.com/thingsboard/thingsboard/pull/12802) Fixed transport messages max number hints by @maxunbearable
  * [#12599](https://github.com/thingsboard/thingsboard/pull/12599) Fixed unclear cached result in dashboard autocomplete after user switch by @vvlladd28
  * [#12909](https://github.com/thingsboard/thingsboard/pull/12909) Fixed validation for target entity type in the Create Relation node by @ArtemDzhereleiko

* Transport

  * [#12725](https://github.com/thingsboard/thingsboard/pull/12725) Fixed CoAP server enable/disable property by @YevhenBondarenko
  * [#12378](https://github.com/thingsboard/thingsboard/pull/12378) Fixed concurrent device communication over DTLS (CoAP) by @nickAS21
  * [#12876](https://github.com/thingsboard/thingsboard/pull/12876) Fixed FOTA update via URL (LwM2M) by @nickAS21
  * [#12699](https://github.com/thingsboard/thingsboard/pull/12699) Fixed Observe for Object ID 3 (DEVICE) v1.1 (LwM2M) by @nickAS21
  * [#12734](https://github.com/thingsboard/thingsboard/pull/12734) Fixed request sending failure (SNMP) by @artem-barysh-dev
  * [#12398](https://github.com/thingsboard/thingsboard/pull/12398) Fixed dynamic update of device profile configuration (LwM2M) by @nickAS21


**Breaking changes**

* [#11937](https://github.com/thingsboard/thingsboard/pull/11937) ‚ùå Removed all queue types except Kafka  
  ‚Üí **Impact**: Systems previously using other queue types (e.g., RabbitMQ) must now migrate to Kafka. Ensure your infrastructure and configuration are updated accordingly.

* [#12859](https://github.com/thingsboard/thingsboard/pull/12859) üßπ Removed `flex-layout` library from the UI  
  ‚Üí **Impact**: Custom UI components or extensions relying on `flex-layout` will break. Replace with Angular‚Äôs native layout features or modern CSS techniques.

**New Contributors**

* @str4ng3-r made their first contribution in [#12568](https://github.com/thingsboard/thingsboard/pull/12568)

**Full Changelog**: [https://github.com/thingsboard/thingsboard/compare/v3.9.1...v4.0](https://github.com/thingsboard/thingsboard/compare/v3.9.1...v4.0)
