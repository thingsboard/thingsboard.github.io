* TOC 
{:toc}

## Overview

Since ThingsBoard 3.3, the Tenant administrator is able to provision and distribute firmware updates to devices. As a
tenant administrator, you can assign provisioned firmware to specific device or device profile. As well as customers can assign existed firmware to 
their devices. ThingsBoard notifies devices about available firmware update, provide a protocol-specific API to download the firmware, stores
history of the updates, and provides a dashboard to monitor the update process.

## Provisioning

As a tenant administrator, you can navigate to the "Firmware" menu item to list and upload firmware updates. 
Each firmware update consist of:

* Title - the name of your firmware package. You can use different names for production and debug firmware. 
* Version - the version of your firmware package. Combination of the title and version must be unique in scope of a tenant.
* Link to Device Profile - each firmware references a device profile. This helps to prevent accidental updates of devices with incompatible firmware. 
  Link to a device profile means that this device *may* be updated to the current firmware. 
  However, the update is not triggered, until the user or script [assigns](#assignment) the firmware to the device profile or device.
* Type - can be either *Firmware* or *Software*. Each device can have an MCU firmware.     
* Checksum algorithm - short name of the checksum algorithm to use. Optional.
* Checksum - value of the file checksum. Optional. If no checksum provided by the user, server will use SHA-256 algorithm automatically.
* Description - optional text description of the firmware. 

{% include images-gallery.html imageCollection="createFirmware" %}

You can browse the provisioned firmware packages as well as search them by title. Also, you are able to download and delete packages.
To open firmware details page, click the table row. Firmware details allow you to copy firmware ID and checksum. 
Also, in [Audit logs](/docs/{{docsPrefix}}user-guide/audit-log/) you can browse firmware status.

{% include images-gallery.html imageCollection="listFirmware" %}

All actions listed are also available via [REST API](/docs/{{docsPrefix}}reference/rest-api/).

## Assignment

As a tenant administrator, you are able to assign uploaded firmware to the device profile or particular device. 
The firmware version assigned to the device will automatically overwrite firmware version that is assigned to the device profile.

{% include images-gallery.html imageCollection="deviceFirmware" %}

You can also assign firmware via Device profile. With this field, we define what type of device this firmware will be available.
However, please notice that when you assign firmware through device profile, to all devices with this profile will be sent notification about the updating. 
Exception will be devices that have already had this firmware, they won't receive update notification.

{% include images-gallery.html imageCollection="fw-deviceprofile" %}

{% capture delete_restrictions %}
Deletion of the firmware packages that is assigned to at least one device or device profile is prohibited.
{% endcapture %}
{% include templates/info-banner.md content=delete_restrictions %}


## Update process

{% capture contenttogglespec %}
HTTP<br/>%,%http%,%templates/install/http-firmware.md%br%
MQTT<br/>%,%mqtt%,%templates/install/mqtt-firmware.md%br%
CoAP<br/>%,%aws%,%templates/install/coap-firmware.md%br%{% endcapture %}
{% include content-toggle.html content-toggle-id="remoteintegrationdockerinstall" toggle-spec=contenttogglespec %}

## Dashboard

To monitor and track the firmware update status of your device, such as which devices are updating right now, 
any boot issues, and which ones have already been updated, you should go to the Firmware dashboard.
It is created automatically when you add firmware to ThingsBoard.
There you can see a list of all devices with full information about their firmware. 
Use the tabs on the right side of the page to see more detailed status information.

{% include images-gallery.html imageCollection="fw-dashboard" %}

Find out more about the firmware update status of specific devices by clicking the "History firmware update" button next to the device name.

{% include images-gallery.html imageCollection="fw-status" %}

There are exist eight statuses. Two of them are created by us and all the rest are generated by the device itself.

1. _Queued_ - notification is in a queue to be sent to the device.
2. _Initiated_ - device was notified.
3. _Downloading_ - device started downloading firmware.
4. _Downloaded_ - device completed downloading of the firmware.
5. _Verified_ - if the checksum of received data was successfully verified by the device.
6. _Updating_ - if the verification is successful, the device firmware is updating.
7. _Updated_ - the firmware was updated to the next version.
8. _Failed_ - checksum wasn't verified, or the device failed to update.

{% include images-gallery.html imageCollection="fw-status-1" %}

## Configuration

##### ThingsBoard configuration file

Execute following command to edit ThingsBoard configuration file:

```bash
sudo nano /etc/thingsboard/conf/thingsboard.conf
```
{: .copy-code}

To set the max number of devices that will be notified in the chosen time period, in terminal execute following properties:

```bash
export TB_QUEUE_CORE_FW_PACK_INTERVAL_MS=60000
export TB_QUEUE_CORE_FW_PACK_SIZE=100
```
{: .copy-code}

##### Max size setting

Max size of firmware that we can save in database is 2 gb. It can not be configured.
