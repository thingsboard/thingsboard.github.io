{%- assign families = site.data["releases-table"] -%}

<div class="releases-table">
    <div class="releases-table-content">
        <div class="releases-table-header">
            <div class="releases-table-header-item">Version</div>
            <div class="releases-table-header-item">Release Date</div>
            <div class="releases-table-header-item">Latest Tag</div>
            <div class="releases-table-header-item">Last Updated</div>
            <div class="releases-table-header-item">Support Until</div>
            <div class="releases-table-header-item">Status</div>
            <div class="releases-table-header-item">Release Notes</div>
            <div class="releases-table-header-item">Upgrade Instructions</div>
        </div>

        <div class="releases-table-row">
            {%- for family in families -%}
                {%- assign releases = family.releases -%}
                {%- assign latest = releases | first -%}
                {%- assign first = releases | last -%}

                {%- assign x_url = page.url | append: family.version | append: ".x/" -%}
                {%- assign page_exists = false -%}
                {%- for p in site.pages -%}
                    {%- if p.url == x_url -%}
                        {%- assign page_exists = true -%}
                    {%- endif -%}
                {%- endfor -%}

                {%- assign family_label = family.version | append: ".x" -%}

                {%- if page_exists -%}
                    {%- assign notes_url = x_url -%}
                {%- else -%}
                    {%- assign notes_url = page.url | append: latest.version | append: "/" -%}
                {%- endif -%}

                <div class="releases-table-content-wrapper">
                    <div class="releases-table-content">
                        <div class="releases-table-content-item">{{ family_label }}</div>
                        <div class="releases-table-content-item">{{ first["release-date"] | default: "—" }}</div>
                        <div class="releases-table-content-item">{{ latest.version | default: "—" }}</div>
                        <div class="releases-table-content-item">{{ latest["release-date"] | default: "—" }}</div>
                        <div class="releases-table-content-item">—</div>
                        <div class="releases-table-content-item">—</div>
                        <div class="releases-table-content-item">
                            <a href="{{ notes_url }}">{{ family_label }}</a>
                        </div>
                        <div class="releases-table-content-item">
                            {%- assign version_param = family.version | append: ".x" -%}
                            <a href="/docs/user-guide/install/{{ docsPrefix }}upgrade-instructions/?version={{ version_param }}">Upgrade</a>
                        </div>
                    </div>
                </div>
            {%- endfor -%}
        </div>
    </div>
</div>
